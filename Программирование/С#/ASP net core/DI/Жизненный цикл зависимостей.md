```
var builder = WebApplication.CreateBuilder();  

builder.Services.AddTransient<ICounter, RandomCounter>();  
builder.Services.AddTransient<CounterService>();  
var app = builder.Build();  
app.UseMiddleware<CounterMiddleware>();  
app.Run();  
  
public class CounterMiddleware  
{  
    private RequestDelegate _next;  
    private int i = 0; // счетчик запросов  
    public CounterMiddleware(RequestDelegate next)  
    {   
		_next = next;  
    }  
    
    public async Task InvokeAsync(HttpContext httpContext, ICounter counter, CounterService counterService)  
    {  
        i++;  
        httpContext.Response.ContentType = "text/html;charset=utf-8";  
        await httpContext.Response.WriteAsync($"Запрос {i}; Counter: {counter.Value}; Service: {counterService.Counter.Value}");  
    }  
}  
  
public class CounterService  
{  
    public ICounter Counter { get; }  
    public CounterService(ICounter counter)  
    {  
        Counter = counter;  
    }  
}  
  
public class RandomCounter : ICounter  
{  
    static Random rnd = new Random();  
    private int _value;  
    public RandomCounter()  
    {  
        _value = rnd.Next(0, 1000000);  
    }  
    public int Value  
    {  
        get => _value;  
    }  
}  
  
public interface ICounter  
{  
    int Value { get; }  
}
```

- Transient: при каждом обращении к сервису создается новый объект сервиса. В течение одного запроса может быть несколько обращений к сервису, соответственно при каждом обращении будет создаваться новый объект. Подобная модель жизненного цикла наиболее подходит для легковесных сервисов, которые не хранят данных о состоянии
    
- Scoped: для каждого запроса создается свой объект сервиса. То есть если в течение одного запроса есть несколько обращений к одному сервису, то при всех этих обращениях будет использоваться один и тот же объект сервиса.
    
- Singleton: объект сервиса создается при первом обращении к нему, все последующие запросы используют один и тот же ранее созданный объект сервиса. 

При изменении в коде AddTransient на AddScoped или AddSingleton результат работы изменится соответсвенно.

Transient будет на каждый вызов 
```
builder.Services.AddTransient<ICounter, RandomCounter>(); 
```
будет создавать новый объект Random count

Scoped на один вызов 
```
builder.Services.AddScoped<ICounter, RandomCounter>();
```
будет создавать один объект сервиса и в дальнейшем им оперировать, но при перезапуске объект пересоздастся.

Singleton создаст один объект и будет им оперировать на запуске и перезагрузке 
```
builder.Services.AddSingleton<ICounter, RandomCounter>();
```

