`Exchange` — обменник или точка обмена. В него отправляются сообщения. `Exchange`**распределяет сообщение** в одну или несколько очередей. Он **маршрутизирует сообщения в очередь** на основе созданных связей (`bindings`) между ним и очередью.
#### _Direct Exchange_

`Direct exchange` — используется, когда нужно **доставить сообщение в определенные очереди**. Сообщение публикуется в обменник с определенным **ключом маршрутизации** и попадает во все очереди, которые связаны с этим обменником аналогичным ключом маршрутизации. **Ключ маршрутизации — это строка**. Поиск соответствия происходит при помощи **проверки строк на эквивалентность**.

Графическое представление потока сообщений:
![rabbitmq_4](https://habrastorage.org/r/w1560/webt/zg/3h/lj/zg3hljyzecuxqawkeamutasd2em.jpeg)

В `rabbitmq` существует понятие **обменник по умолчанию**. Это `direct exchange` без имени. Если применяется обменник по умолчанию, то сообщение будет маршрутизироваться в очередь с именем равным **ключу маршрутизации сообщения**.

Для того чтобы задать обменник по умолчанию нужно написать: 
```csharp
channel.BasicPublish(
					exchange: string.Empty,  
					routingKey: "hello",  
					basicProperties: null,  
					body: body);
```

Мы задаем exchange значение empty и это вызывает exchange по умолчанию

#### _Topic Exchange_

`Topic exchange` – аналогично `direct exchange` дает возможность осуществления выборочной маршрутизации путем сравнения ключа маршрутизации. Но, в данном случае, ключ задается **по шаблону**. При создании шаблона используются `0` или более слов (буквы `AZ` и `az` и цифры `0-9`), разделенных точкой, а также символы `*` и `#`. 

- `*` — может быть заменен на ровно `1` слово 
- `#` — может быть заменен на `0` или более слов 

Графическое представление потока сообщений:

![rabbitmq_6](https://habrastorage.org/r/w1560/webt/p8/9w/bi/p89wbipkobdmt_85yvyib2kwuru.jpeg)


Начиная с версии `RabbitMQ 2.4.0` алгоритм маршрутизации для `topic exchange` стал работать до `145` раз быстрее. Добились они этого путем внедрения подхода [trie implementation](https://www.rabbitmq.com/blog/2011/03/28/very-fast-and-scalable-topic-routing-part-2/), который подразумевает представление шаблонов в виде структуры дерева. Например шаблоны `a.b.c`, `a.*.b.c`, `a.#.c` и `b.b.c` будут представлены следующей структурой:

![trie-example](https://habrastorage.org/r/w1560/getpro/habr/post_images/759/4d0/204/7594d0204e7e35a9ed7231f4c0108193.png)

Поиск соответствия шаблону осуществляется, начиная с корня и следуя сверху вниз.

Особенности:

- Применение этого обменника может стать **хорошим выбором для возможного будущего развития приложения**, т.к. шаблоны всегда можно настроить так, чтобы сообщение публиковалось аналогично `direct exchange` или `fanout exchange`
- Шаблоны, которые используют `*` **намного быстрее**, чем шаблоны, которые используют `#`. 
- `Topic exchange` медленнее `direct exchange`

#### _Fanout Exchange_

`Fanout exchange` – **все сообщения доставляются во все очереди** даже если в сообщении задан ключ маршрутизации.

Особенности:
- `RabbitMQ` **не работает с ключами маршрутизации и шаблонами** что положительно влияет на производительность. Это самый быстрый `exchange`;
- все потребители должны иметь возможность обрабатывать все сообщения;

Графическое представление потока сообщений:
![rabbitmq_5](https://habrastorage.org/r/w1560/webt/6e/ij/bo/6eijbobnabcyoopzbyec_axnjoe.jpeg)

#### _Headers Exchange_

`Headers exchange` — направляет сообщения в связанные очереди на основе сравнения пар (ключ, значение) свойства `headers` привязки и аналогичного свойства сообщения. `headers`представляет собой `Dictionary<ключ, значение>`. 

Если в словарь добавить специальный ключ `x-match` со значением `any`, то сообщение маршрутизируется при частичном совпадении пар (ключ, значение). Данное поведение аналогично оператору `or`. 

```csharp
var bindingArguments = new Dictinary<String, Object>();
bindingArguments.add("x-match", "any");
```

По умолчанию ключ `x-match` содержит значение `all`. Это означает, что сообщение маршрутизируется при полном совпадении пар (ключ, значение). Данное поведение аналогично оператору `and`.

Графическое представление потока сообщений:  
![rabbitmq_7_a](https://habrastorage.org/r/w1560/webt/nr/fi/4f/nrfi4fzr8uu1qhwrwe9avj5sryk.jpeg)

Особенности:

- дополнительная гибкость
- дополнительные накладные расходы на вычисление. Все пары (ключ, значение) атрибута `headers` должны сортироваться по имени ключа перед вычислением значений маршрутизации сообщения. **Медленнее, чем прочие типы exchange**.

 